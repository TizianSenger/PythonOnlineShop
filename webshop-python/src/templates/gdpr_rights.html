{% extends "base.html" %}

{% block title %}Datenschutz & Betroffenenrechte - WebShop{% endblock %}

{% block content %}
<div class="container my-5">
    {% if user %}
    <h1>Datenschutz & Betroffenenrechte</h1>
    <p class="text-muted">Nach der DSGVO haben Sie folgende Rechte bez√ºglich Ihrer Daten:</p>

    <div class="row mt-4">
        <!-- Recht auf Auskunft -->
        <div class="col-md-6 mb-4">
            <div class="card">
                <div class="card-header bg-info text-white">
                    <h5 class="mb-0">üìã Recht auf Auskunft (Art. 15 DSGVO)</h5>
                </div>
                <div class="card-body">
                    <p>Sehen Sie alle Daten, die wir √ºber Sie gespeichert haben:</p>
                    <ul class="small">
                        <li>Profildetails (Name, E-Mail, Adresse)</li>
                        <li>Bestellhistorie</li>
                        <li>Audit-Logs (Login, Aktivit√§ten)</li>
                        <li>Cookie-Einwilligungen</li>
                    </ul>
                    <form method="get" action="{{ url_for('gdpr_data_export') }}">
                        <button type="submit" class="btn btn-sm btn-info mt-2">
                            Meine Daten ansehen
                        </button>
                    </form>
                </div>
            </div>
        </div>

        <!-- Datenportabilit√§t -->
        <div class="col-md-6 mb-4">
            <div class="card">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0">üíæ Datenportabilit√§t (Art. 20 DSGVO)</h5>
                </div>
                <div class="card-body">
                    <p>Exportieren Sie Ihre Daten in maschinenlesbarem Format:</p>
                    <ul class="small">
                        <li>JSON oder CSV Export</li>
                        <li>Alle pers√∂nlichen Informationen</li>
                        <li>Transferierbar zu anderen Anbietern</li>
                    </ul>
                    <form method="post" action="{{ url_for('gdpr_export_data') }}">
                        <div class="mb-2">
                            <label for="export-format" class="form-label">Format:</label>
                            <select id="export-format" name="format" class="form-select form-select-sm">
                                <option value="json">JSON</option>
                                <option value="csv">CSV</option>
                            </select>
                        </div>
                        <button type="submit" class="btn btn-sm btn-primary">
                            Daten exportieren
                        </button>
                    </form>
                </div>
            </div>
        </div>

        <!-- Berichtigungsrecht -->
        <div class="col-md-6 mb-4">
            <div class="card">
                <div class="card-header bg-warning text-dark">
                    <h5 class="mb-0">‚úèÔ∏è Recht auf Berichtigung (Art. 16 DSGVO)</h5>
                </div>
                <div class="card-body">
                    <p>Aktualisieren Sie Ihre pers√∂nlichen Daten:</p>
                    <ul class="small">
                        <li>Name und Kontaktdaten</li>
                        <li>Lieferadressen</li>
                        <li>Fehlerhafte Informationen</li>
                    </ul>
                    <a href="{{ url_for('profile_edit') }}" class="btn btn-sm btn-warning">
                        Profil bearbeiten
                    </a>
                </div>
            </div>
        </div>

        <!-- L√∂schungsrecht -->
        <div class="col-md-6 mb-4">
            <div class="card border-danger">
                <div class="card-header bg-danger text-white">
                    <h5 class="mb-0">üóëÔ∏è Recht auf Vergessenwerden (Art. 17 DSGVO)</h5>
                </div>
                <div class="card-body">
                    <p><strong>L√∂schen Sie Ihr Konto und alle pers√∂nlichen Daten:</strong></p>
                    <ul class="small">
                        <li>‚úì Benutzerkonto wird gel√∂scht</li>
                        <li>‚úì Pers√∂nliche Daten werden gel√∂scht</li>
                        <li>‚ö†Ô∏è Rechnungen bleiben aus rechtlichen Gr√ºnden</li>
                        <li>‚ö†Ô∏è Diese Aktion kann nicht r√ºckg√§ngig gemacht werden</li>
                    </ul>
                    <button type="button" class="btn btn-sm btn-danger mt-2" data-bs-toggle="modal"
                        data-bs-target="#deleteAccountModal">
                        Konto l√∂schen
                    </button>
                </div>
            </div>
        </div>

        <!-- Widerspruchsrecht -->
        <div class="col-md-6 mb-4">
            <div class="card">
                <div class="card-header bg-secondary text-white">
                    <h5 class="mb-0">üö´ Widerspruchsrecht (Art. 21 DSGVO)</h5>
                </div>
                <div class="card-body">
                    <p>Widersprechen Sie der Verarbeitung Ihrer Daten:</p>
                    <ul class="small">
                        <li>Marketing E-Mails deaktivieren</li>
                        <li>Analytics deaktivieren</li>
                        <li>Personalisierte Werbung ablehnen</li>
                    </ul>
                    <a href="{{ url_for('preferences') }}" class="btn btn-sm btn-secondary">
                        Pr√§ferenzen verwalten
                    </a>
                </div>
            </div>
        </div>

        <!-- Einschr√§nkungsrecht -->
        <div class="col-md-6 mb-4">
            <div class="card">
                <div class="card-header bg-success text-white">
                    <h5 class="mb-0">‚è∏Ô∏è Einschr√§nkungsrecht (Art. 18 DSGVO)</h5>
                </div>
                <div class="card-body">
                    <p>Fordern Sie die Einschr√§nkung der Datenverarbeitung an:</p>
                    <ul class="small">
                        <li>Vor√ºbergehende Pausierung der Verarbeitung</li>
                        <li>F√ºr die Dauer von Rechtsverletzungspr√ºfungen</li>
                        <li>Per E-Mail anforderbar</li>
                    </ul>
                    <a href="mailto:datenschutz@webshop.de?subject=Einschr√§nkung%20Datenverarbeitung"
                        class="btn btn-sm btn-success">
                        Per E-Mail anfragen
                    </a>
                </div>
            </div>
        </div>
    </div>

    <hr class="my-5">

    <div class="alert alert-info">
        <h5>‚ÑπÔ∏è H√§ufig gestellte Fragen</h5>
        <dl>
            <dt>Wie lange dauert eine Anfrage?</dt>
            <dd>Nach DSGVO m√ºssen wir innerhalb von <strong>30 Tagen</strong> antworten (kann um 60 Tage verl√§ngert
                werden).</dd>

            <dt>Welche Daten exportiere ich mit "Datenportabilit√§t"?</dt>
            <dd>Sie erhalten alle Ihre personenbezogenen Daten in strukturiertem, maschinenlesbarem Format (JSON/CSV).
            </dd>

            <dt>Was passiert, wenn ich mein Konto l√∂sche?</dt>
            <dd>
                Ihr Konto und alle pers√∂nlichen Daten werden gel√∂scht. Bestellungen und Rechnungen bleiben
                aus steuerlichen Gr√ºnden (7 Jahre Aufbewahrungspflicht) gespeichert.
            </dd>

            <dt>Kann ich meine Cookie-Einstellungen jederzeit √§ndern?</dt>
            <dd>Ja! √ñffnen Sie einfach das Cookie-Banner in der Website oder nutzen Sie Ihre Browser-Einstellungen.</dd>

            <dt>Wen kontaktiere ich bei Fragen?</dt>
            <dd>
                Datenschutzbeauftragter: <a href="mailto:datenschutz@webshop.de">datenschutz@webshop.de</a><br>
                Telefon: +49 123 456789
            </dd>
        </dl>
    </div>

    <div class="alert alert-warning">
        <strong>‚ö†Ô∏è Wichtig:</strong> Diese Funktionen sind DSGVO-konform. Alle Anfragen werden geloggt und
        k√∂nnen von unseren Administratoren √ºberpr√ºft werden.
    </div>

    {% else %}
    <div class="alert alert-warning">
        <strong>‚ö†Ô∏è Bitte melden Sie sich an</strong>, um Ihre DSGVO-Rechte zu verwalten.
    </div>
    <a href="{{ url_for('login') }}" class="btn btn-primary">Jetzt anmelden</a>
    {% endif %}
</div>

<!-- Delete Account Modal -->
<div class="modal fade" id="deleteAccountModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content border-danger">
            <div class="modal-header bg-danger text-white">
                <h5 class="modal-title">‚ö†Ô∏è Konto l√∂schen - Best√§tigung erforderlich</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <p><strong>Achtung:</strong> Diese Aktion kann <u>nicht r√ºckg√§ngig gemacht werden</u>.</p>
                <p>Wenn Sie Ihr Konto l√∂schen:</p>
                <ul>
                    <li>‚úó Ihr Benutzerkonto wird gel√∂scht</li>
                    <li>‚úó Alle pers√∂nlichen Daten werden gel√∂scht</li>
                    <li>‚úó Sie k√∂nnen sich nicht mehr anmelden</li>
                    <li>‚úì Bestellungen bleiben als Referenz erhalten</li>
                </ul>
                <div class="form-check mt-3">
                    <input class="form-check-input" type="checkbox" id="confirmDelete">
                    <label class="form-check-label" for="confirmDelete">
                        Ich verstehe, dass diese Aktion nicht r√ºckg√§ngig gemacht werden kann
                    </label>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Abbrechen</button>
                <form method="post" action="{{ url_for('gdpr_delete_account') }}" style="display: inline;">
                    <button type="submit" class="btn btn-danger" id="confirmDeleteBtn" disabled>
                        Konto permanent l√∂schen
                    </button>
                </form>
            </div>
        </div>
    </div>
</div>

<script>
    // Enable delete button only when checkbox is checked
    document.getElementById('confirmDelete')?.addEventListener('change', (e) => {
        document.getElementById('confirmDeleteBtn').disabled = !e.target.checked;
    });
</script>

{% endblock %}